document.observe("click",function(e,t){if(t=e.findElement("form a.add_nested_fields")){var n=t.readAttribute("data-association"),r=$(n+"_fields_blueprint").innerHTML,s=(t.getOffsetParent(".fields").firstDescendant().readAttribute("name")||"").replace(new RegExp("[[a-z]+]$"),"");if(s){var o=s.match(/[a-z_]+_attributes/g)||[],u=s.match(/(new_)?[0-9]+/g)||[];for(i=0;i<o.length;i++)u[i]&&(r=r.replace(new RegExp("(_"+o[i]+")_.+?_","g"),"$1_"+u[i]+"_"),r=r.replace(new RegExp("(\\["+o[i]+"\\])\\[.+?\\]","g"),"$1["+u[i]+"]"))}var a=new RegExp("new_"+n,"g"),f=(new Date).getTime();r=r.replace(a,"new_"+f);var l=t.insert({before:r});return l.fire("nested:fieldAdded",{field:l}),l.fire("nested:fieldAdded:"+n,{field:l}),!1}}),document.observe("click",function(e,t){if(t=e.findElement("form a.remove_nested_fields")){var n=t.previous(0),r=t.readAttribute("data-association");n&&(n.value="1");var i=t.up(".fields").hide();return i.fire("nested:fieldRemoved",{field:i}),i.fire("nested:fieldRemoved:"+r,{field:i}),!1}});