(function(){var __bind=function(e,t){return function(){return e.apply(t,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define(["jquery","backbone","models/resource","text!templates/visor.js","froogaloop2.min"],function($,Backbone,ResourceModel,VisorTPL,F){var VisorView;return VisorView=function(_super){function VisorView(){return this.ratingSet=__bind(this.ratingSet,this),this.hideOverlay=__bind(this.hideOverlay,this),this.showOverlay=__bind(this.showOverlay,this),this.close=__bind(this.close,this),this.render=__bind(this.render,this),VisorView.__super__.constructor.apply(this,arguments)}return __extends(VisorView,_super),VisorView.prototype.el=$("#templating"),VisorView.prototype.events={"mouseenter .rating .star":"ratingON","mouseleave .rating .star":"ratingOFF","click .rating .star":"ratingSet","mouseenter .thi":"showOverlay","mouseleave .thi":"hideOverlay"},VisorView.prototype.initialize=function(parent){var _this=this;return this.parent=parent,this.tpl=eval(VisorTPL),this.id=parent.attr("id"),this.model=new ResourceModel({id:this.id}),this.model.fetch(),this.model.on("change",function(){return _this.render()})},VisorView.prototype.render=function(){var e,t=this;return e=this.tpl(this.model.toJSON()),$(this.el).append(e),$("#visor-modal").reveal({animation:"fadeAndPop",opened:function(){if(t.model.get("type")==="video")return t.model.get("provider")==="youtube"?t.loadYoutubePlayer(t.model.get("video_id"),"ytplayer"):t.loadVimeoPlayer(t.model.get("url"))},closed:function(){return t.close()}})},VisorView.prototype.close=function(){return $(this.el).empty(),$(this.el).undelegate()},VisorView.prototype.showOverlay=function(e){return $(e.currentTarget).find(".overlay").show()},VisorView.prototype.hideOverlay=function(e){return $(e.currentTarget).find(".overlay").hide()},VisorView.prototype.ratingON=function(e){return $(e.currentTarget).prevAll().andSelf().addClass("on"),$(e.currentTarget).nextAll().removeClass("on")},VisorView.prototype.ratingOFF=function(e){return $(e.currentTarget).prevAll().andSelf().removeClass("on")},VisorView.prototype.ratingSet=function(e){var t,n,r=this;return $(e.currentTarget).siblings(".voted").andSelf().removeClass("voted"),n=$(e.currentTarget).siblings(".on").andSelf(),n.addClass("voted"),t=n.length,$.post("/votos/"+this.id+"/"+t,function(e){var t,n,i,s,o,u;if(e.result===!0){t=""+e.promedio+"/"+e.total,$("#visor-modal").find(".votos_count").html(t),$("#"+r.id).find(".votos_count").html(t),t="";for(n=i=1,o=e.promedio;1<=o?i<=o:i>=o;n=1<=o?++i:--i)t+='<img src="/assets/STAR_ON.gif"/>';for(n=s=u=e.promedio;u<=5?s<5:s>5;n=u<=5?++s:--s)t+='<img src="/assets/STAR_OFF.gif"/>';return $("#visor-modal").find(".estrellas").html(t),$("#"+r.id).find(".estrellas").html(t)}})},VisorView.prototype.loadVimeoPlayer=function(e){var t,n;return n=$f($("#vmplayer")[0]),t=!1,n.addEvent("ready",function(e){return $(".start").live("click",function(e){return n.api("play"),$(".start").addClass("active"),$(".pausa").removeClass("active")}),$(".pausa").live("click",function(e){return n.api("pause"),$(".start").removeClass("active"),$(".pausa").addClass("active")}),n.addEvent("playProgress",function(e,t){var n,r;return n=e.seconds,r=e.percent*100,$(".video_controls .time").html(String(n).toHHMMSS()),$(".video_controls .bar").css("width",r+"%")})})},VisorView.prototype.loadYoutubePlayer=function(e,t){var n,r,i;return i=null,n=!1,r=function(e,t){var r;return r={width:"754",height:"492",videoId:e,playerVars:{autoplay:0,controls:0,enablejsapi:1,showinfo:0,iv_load_policy:3,color:"white",theme:"light",origin:"http://dandoodev.herokuapp.com",autohide:1,disablekb:1,modestbranding:1,playerpiid:t,rel:0},events:{onReady:function(e){return n=!1},onStateChange:function(e){switch(e.data){case-1:break;case 0:return clearInterval(0),$(".pausa").addClass("active");case 1:return $(".start").addClass("active"),$(".pausa").removeClass("active"),setInterval(function(){var e,t;return e=i.getCurrentTime(),$(".video_controls .time").html(String(e).toHHMMSS()),t=e/i.getDuration()*100,$(".video_controls .bar").css("width",t+"%")},500);case 2:return $(".start").removeClass("active"),$(".pausa").addClass("active"),clearInterval(0);case 3:$(".start").removeClass("active"),$(".pausa").addClass("active"),clearInterval(0);break;case 5:return $(".start").removeClass("active"),$(".pausa").addClass("active"),clearInterval(0),n=!1}}}},i=new YT.Player(t,r),$(".start").live("click",function(e){switch(i.getPlayerState()){case-1:case 0:case 2:case 5:return i.playVideo()}}),$(".pausa").live("click",function(e){if(i.getPlayerState()===1)return i.pauseVideo()})},r(e,t)},VisorView}(Backbone.View)})}).call(this);