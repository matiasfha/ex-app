<%
user = User.find(@resource.user_id)
can_delete = false
if !@user.nil?
	if !current_user.nil?
		if @user.id == current_user.id && @resource.user_id == current_user.id 
			can_delete = true
		end
	end
end 
voto = nil
if !current_user.nil?
	voto = Voto.where(:resource_id => @resource.id,:user_id => current_user.id).first
end

imagen = @resource.imagen.url(:large)
if imagen.nil?
	imagen = @resource.thumbnail
end
%>
{
	"FACEBOOK_KEY":"<%=ENV['FACEBOOK_KEY']%>",
	"id":"<%=@resource.id%>",
	"type":"<%=@resource.type%>",
	"can_delete":<%=can_delete%>,
	"imagen":"<%=imagen%>",
	"provider":"<%=@resource.provider%>",
	"url":"<%=@resource.url%>",
	"video_id":"<%=@resource.url.split("=")[1]%>",
	"titulo":"<%=@resource.titulo%>",
	"descripcion":"<%=@resource.descripcion%>",
	"signed_in":<%=user_signed_in?%>,
	"like": "<%=(!current_user.nil?) ? @resource.likers.where(:id => current_user.id).count : 0%>",
	"voto":"<%=(voto.nil?) ? "": voto%>",
	"voto_valor":"<%=(voto.nil?) ? 0 : voto.valor%> ",
	"voto_style":"<%=(voto.nil?) ? "": "voted"%> ",
	"total_likers":"<%=@resource.likers.count%>",
	"total_comments":"<%=@resource.comments.count%>",
	"total_votos":"<%=@resource.votos.count%>",
	"promedio_votos":"<%=Resource.promedio_votos(@resource.id).round%>",
	"user_avatar":"<%=user.avatar.url(:thumb)%>",
	"user_id":"<%=user.id%>",
	"user_nickname":"<%=user.nickname%>",
	"current_user_avatar":"<%=(!current_user.nil?) ? current_user.avatar.url(:thumb) : false %>",
	"current_user_nickname":"<%=(!current_user.nil?) ? current_user.nickname : false %>"
	<% if @resource.comments.count > 0 %>
	,"comments":[
		<%
		comments = @resource.comments.order_by([[:created_at,:desc]]).limit(2).to_a().reverse
		comments.each_with_index do |comentario,indice|
			comment_user = User.find(comentario.user_id)
			if current_user.nil?
				can_edit = false
			else
				if current_user.id == comment_user.id
					can_edit = true
				else
					can_edit = false
				end
			end
			%>
			{
			"id":"<%=comentario.id%>",
			"avatar":"<%=comment_user.avatar.url(:thumb)%>",
			"user_nickname":"<%=comment_user.nickname%>",
			"user_id":"<%=comment_user.id%>",
			"fecha":"<%=comentario.created_at.strftime("%d-%m-%Y / %I:%M:%S %p") %>",
			"contenido":"<%=comentario.contenido%>",
			"can_edit":"<%=can_edit%>"
			}
			<%
			if indice != comments.size - 1
				%>
				,
				<%
			end
		end
	%>
	]
	<% end #if resource.comments.count%>
}